# mineservtelebot

---

# Запуск:
### СОЗДАНИЕ ВИРТУАЛЬНОГО ОКРУЖЕНИЯ
python3 -m venv /root/minecraft/mineservtelebot/venv
### ВКЛЮЧЕНИЕ ВИРТУАЛЬНОГО ОКРУЖЕНИЯ
source /root/minecraft/mineservtelebot/venv/bin/activate
### УСТАНОВКА ЗАВИСИМОСТЕЙ
pip install python-telegram-bot sqlalchemy python-dotenv
### РУЧНОЕ ВКЛЮЧЕНИЕ
python /root/minecraft/mineservtelebot/mineservtelebot.py
### ВКЛЮЧЕНИЕ В ФОНЕ
screen -S mineservtelebot_start_py -d -m bash -c "source /root/minecraft/mineservtelebot/venv/bin/activate && python /root/minecraft/mineservtelebot/mineservtelebot.py"

---

## СТРУКТУРА БОТА mineservtelebot
```
mineservtelebot/
├── .env				# ПЕРЕМННЫЕ - ТОКЕНЫ ТГ, ID АДМИНОВ, ПОРТЫ, ПУТИ 
├── mineservtelebot.py			# ЗАПУСК БОТА И ОСНОВНОЙ ФАЙЛ С ЛОГИКОЙ
└── server_menu/			# СКРИПТЫ РАБОТЫ С СЕРВЕРОМ
	├── __init__.py
	├── service.py			# ФУНКЦИИ ОТПРАВКИ ЗАПРОСОВ К СЕРВЕРУ О ЕГО СТАТУСЕ - КОЛЛИЧЕСТВО ИГРОКОВ, ТПС, ИСПОЛЬЗОВАНИИ ЦПУ И ОЗУ, ВЕС И РАЗМЕР МИРА - ЗАПУСК СКРИПТОВ ВКЛЮЧЕНИЯ, ПЕРЕЗАГРУЗКИ, ВЫКЛЮЧЕНИЯ СЕРВЕРА, И СОЗДАНИЯ КОПИИ МИРА
	├── server.py			# ФУНКЦИИ ОТПРАВКИ ЗАПРОСОВ К СЕРВЕРУ, ОТПРАВКА СООБЩЕНИЙ ВСЕМ В ЧАТ ИГРЫ, ОТПРАВКА СООБЩЕНИЯ О ПОГОДЕ И ПОЛУЧЕНИЕ ЕГО ОТ СЕРВЕРА, ОТПРАВКА ПРИВАТНОГО СООБЩЕНИЯ ИГРОКУ В ИГРУ
	├── whitelist.py		# ФУНКЦИИ РАБОТЫ С WHITELIST, ДОБАВЛЕНИЕ, УДАЛЕНИЕ, ПЕРЕЗАГРУЗКА
	└── scripts			# СКРИПТЫ РАБОТЫ С СЕРВЕРОМ
		├── backup.sh		# СОЗДАЕТ КОПИЮ МИРА
		├── start.sh		# ВКЛЮЧАЕТ СЕРВЕР
		├── stop.sh		# ВКЛЮЧАЕТ СЕРВЕР
		└── restart.sh 		# ПЕРЕЗАГРУЖАЕТ СЕРВЕР
```

---

## ФУНКЦИОНАЛ БОТА mineservtelebot
```
\ОСНОВНОЕ МЕНЮ\ - ОСНОВНОЕ МЕНЮ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /start 
├── \ВЫЙТИ\ - ЗАКРЫВАЕТ МЕНЮ 
├── \ПРИВЕТСТВИЕ\ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /hello 
├── \О СЕРВЕРЕ\ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /readme 
├── \ИНСТРУКЦИЯ\ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /help 
├── ...ЕСЛИ НЕ ЗАРЕГИСТРИРОВАН... - НЕ ЗАРЕГИСТРИРОВАНЫМ ПОЛЬЗОВАТЕЛЯМ (И АДМИНАМ, НА АЙДИ ТГ КОТОРЫХ НЕТ РЕГИСТРАЦИИ) ПОКАЗЫВАЕТСЯ КНОПКА РЕГИСТРАЦИИ ВЕДУЩАЯ В МЕНЮ РЕГИСТРАЦИИ 
│   ├── \РЕГИСТРАЦИЯ\ - ВКЛЮЧАЕТСЯ МЕНЮ РЕГИСТРАЦИИ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /reg 
│   └── ...АВТОМАТИЧЕСКИ ПАРСИТСЯ НИК ТГ... - ИСПОЛЬЗУЕТСЯ КАК ИДЕНТИФИКАТОР ПОЛЬЗОВАТЕЛЯ 
│   	├── \ВВЕДИТЕ ВНУТРИИГРОВОЙ НИК\ - ПОЯВЛЯЕТСЯ ВОЗМОЖНОСТЬ ВВЕСТИ НИК, КОТОРЫЙ ПОТОМ БУДЕТ ИСПОЛЬЗОВАТЬСЯ В ИГРЕ ЧЕРЕЗ whitelist.py
│   	├── \ВВЕДИНЕ IP\ - ПОЯВЛЯЕТСЯ ВОЗМОЖНОСТЬ ВВЕСТИ СВОЙ IP, КОТОРЫЙ БУДЕТ ПОТОМ ИСПОЛЬЗОВАТЬСЯ ДЛЯ СОЗДАНИЯ ПРАВИЛА ЧЕРЕЗ whitelist.py
│   	└── \ПОДТВЕРДИТЕ ВВОДИМЫЕ ДАННЫЕ\ - ОТОБРАЖАЮТСЯ РАНЕЕ ВЕДЕННЫЕ ДАННЫЕ ДЛЯ ПОДТВЕРЖДЕНИЯ 
│   		├── \ПОДТВЕРДИТЬ\ - ПОЯВЛЯЕТСЯ СООБЩЕНИЕ О ОЖИДАНИИ ПОДТВЕРЖДЕНИЯ, СООБЩЕНИЕ О НОВОЙ ЗАЯВКЕ ПРИХОДИТ В ЧАТ АДМИНИСТРАТОРАМ
│   		└── \ОТКЛОНИТЬ\ - РЕГИСТРАЦИЯ ПРЕКРАЩАЕТСЯ, ДИАЛОГ С БОТОМ ЗАКРЫВАЕТСЯ 
├── ...ЕСЛИ ЗАРЕГИСТРИРОВАН... - НЕОДОБРЕННЫМ И ОДОБРЕННЫМ ПОЛЬЗОВАТЕЛЯМ (И АДМИНАМ С РЕГИСТРАЦИЕЙ ПО ИХ ТГ АЙДИ) ПОКАЗЫВАЕТСЯ КНОПКА ВЕДУЩАЯ В МЕНЮ РАБОТЫ ПОЛЬЗОВАТЕЛЕЙ
│   └── \МЕНЮ ПОЛЬЗОВАТЕЛЯ\ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /user 
│   	├── ...ЕСЛИ НЕ ОДОБРЕН... - ПОСЛЕ РЕГИСТРАЦИИ ОЖИДАЕТСЯ ПОДТВЕРЖДЕНИЕ АДМИНИСТРАЦИИ 
│   	│   ├── \ПРОВЕРИТЬ ЗАЯВКУ\ - СООБЩАЕТ РАНЕЕ ВВЕДЕННЫЕ ПРИ РЕГИСТРАЦИИ ДАННЫЕ 
│   	│   ├── \ИЗВЕНИТЬ ЗАЯВКУ\ - ПРЕДЛАГАЕТ ИЗМЕНИТЬ РАНЕЕ ВВЕДЕННЫЕ ПРИ РЕГИСТРАЦИИ ДАННЫЕ 
│   	│   │   ├── \ПОДТВЕРДИТЬ\ - ДАННЫЕ МЕНЯЮТСЯ, ПОЯВЛЯЕТСЯ СООБЩЕНИЕ О ОЖИДАНИИ ПОДТВЕРЖДЕНИЯ, СООБЩЕНИЕ О ИЗМЕНЕНИИ В ЗАЯВКЕ ПРИХОДИТ В ЧАТ АДМИНИСТРАТОРАМ
│   	│   │   └── \ОТКЛОНИТЬ\ - ИЗМЕНЕНИЕ ПРЕКРАЩАЕТСЯ, ДИАЛОГ С БОТОМ ЗАКРЫВАЕТСЯ 
│   	│   └── \ОТМЕНИТЬ ЗАЯВКУ\ - ОТМЕНЯЯЕТ ЗАЯВКУ, УДАЛЯЕТ ДАННЫЕ И ЗАПИСЬ, ДИАЛОГ С БОТОМ ЗАКРЫВАЕТСЯ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /unreg
│   	└── ....ЕСЛИ ОДОБРЕН... - ПОСЛЕ ОДОБРЕНИЯ, ДАЕТ ДОСТУП К ОСНОВНОМУ МЕНЮ ПОЛЬЗОВАТЕЛЯ (И АДМИНАМ С РЕГИСТРАЦИЕЙ ПО ИХ ТГ АЙДИ И ОДОБРЕНИЕМ)
│   		├── \ПРОФИЛЬ\ - МЕНЮ ПРОФИЛЯ ЗАПИСИ ПОЛЬЗОВАТЕЛЯ 
│   		│   ├── \ЗАПРОС ИЗМЕНИТЬ ПРОФИЛЬ\ - ОТКРЫВАЕТСЯ ДИАЛОГ О ИЗМЕНЕНИИ НИКА, ПОТОМ ПАРОЛЯ, СООБЩЕНИЕ О ИЗМЕНЕНИИ В ЗАЯВКЕ ПРИХОДИТ В ЧАТ АДМИНИСТРАТОРАМ
│   		│   │   ├── \ПОДТВЕРДИТЬ\ - ПОЯВЛЯЕТСЯ СООБЩЕНИЕ О ОЖИДАНИИ ПОДТВЕРЖДЕНИЯ 
│   		│   │   └── \ОТКЛОНИТЬ\ - ИЗМЕНЕНИЕ ПРОФИЛЯ ПРЕКРАЩАЕТСЯ, ДИАЛОГ С БОТОМ ЗАКРЫВАЕТСЯ
│   		│   └── \УДАЛИТЬ ПРОФИЛЬ\ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /unreg
│   		└── \ФУНКЦИИ РАБОТЫ С СЕРВЕРОМ\ - МЕНЮ ВЫЗОВА ФУНКЦИЙ 
│   			├── \СТАТУС СЕРВЕРА\
│   			├── \КОЛЛИЧЕСТВО ИГРОКОВ\
│   			└── \ПОГОДА НА СЕРВЕРЕ\
└── ...ЕСЛИ АДМИН... - АДМИНАМ ПОКАЗЫВАЕТСЯ МЕНЮ АДМИНОВ
	└── \АДМИНИСТРИРОВАНИЕ\ - ВЫЗЫВАЕТСЯ КОМАНДОЙ К БОТУ /admin (с фильтром на id админов в config.py)
		├── \СЕРВЕРНЫЕ ФУНКЦИИ\ - ОТКРЫВАЕМ МЕНЮ С КОМАНДАМИ К СЕРВЕРУ
		│   ├── \КОЛЛИЧЕСТВО ИГРОКОВ\ - ПОКАЗЫВАЕТ КОЛЛИЧЕСТВО ИГРОКОВ ОНЛАЙН В ИГРЕ
		│   ├── \ОТПРАВИТЬ СООБЩЕНИЕ\ - ОТПРАВЛЯЕТ СООБЩЕНИЕ В ИГРОВОЙ ЧАТ ВСЕМ ИГРОКАМ
		│   ├── \ПОГОДА НА СЕРВЕРЕ\ - ПОКАЗЫВАЕТ ПОГОДУ НА В ИГРЕ
		│   └── \ОБНОВИТЬ WHITELIST\ - ПЕРЕЗАГРУЖАЕТ WHITELIST (reload_whitelist.py)
		├── \СЕРВИСНЫЕ ФУНКЦИИ\ - ОТКРЫВАЕМ МЕНЮ С СЕРВИСНЫМИ ФУНКЦИЯМИ ОБРАЩЕНИЯ К СКРИПТАМ
		│   ├── \КОПИЯ МИРА\ - ЗАПУСКАЕТ КОМАНДУ СОЗДАНИЯ КОПИИ МИРА ()
		│   ├── \ВКЛЮЧЕНИЕ СЕРВЕРА\ - ЗАПУСКАЕТ КОМАНДУ ВКЛЮЧЕНИЯ СЕРВЕРА 
		│   ├── \ПЕРЕЗАГРУЗКА СЕРВЕРА\ - ЗАПУСКАЕТ КОМАНДУ ВЫКЛЮЧЕНИЯ СЕРВЕРА
		│   └── \ВЫКЛЮЧЕНИЕ СЕРВЕРА\ - ЗАПУСКАЕТ КОМАНДУ ПЕРЕЗАГРУЗКИ СЕРВЕРА
		├── \ОТПРАВИТЬ СООБЩЕНИЕ ВСЕМ\ - ПОЯВЛЯЕТСЯ ВОЗМОЖНОСТЬ ВВЕСТИ И ОТПРАВИТЬ СООБЩЕНИЕ В ТГ ВСЕМ ИГРОКАМ С ОДОБРЕННОЙ РЕГСТРИЦИЕЙ
		└── \СПИСОК ПОЛЬЗОВАТЕЛЕЙ\ - ОТКРЫВАЕТ МЕНЮ С РАБОТОЙ С ПОЛЬЗОВАТЕЛЯМИ
			└── ...СПИСОК ПОЛЬЗОВАТЕЛЕЙ... - СПИСОК ПОЛЬЗОВАТЕЛЙ КАК АКТИВНЫХ КНОПОК, С ПОДПИСЯМИ СТАТУСОВ (ЗАЯВКА \ ЗАРЕГИСТРИРОВАН)
				└── \ПОЛЬЗОВАТЕЛЬ\ - МЕНЮ РАБОТЫ С ЗАПИСЬЮ ПОЛЬЗОВАТЕЛЯ
					├── ...ЕСЛИ НЕ ОДОБРЕН... - ВЫВОДИТ ИНФУ О ПОЛЬЗОВАТЕЛЕ, ЕГО СТАТУС, И ПРЕДЛОЖЕНИЕ ОДОБРИТЬ ИЛИ ОТКЛОНИТЬ РЕГИСТРАЦИЮ
					│   ├── \ОДОБРИТЬ\ - ОДОБРЯЕТ РЕГИСТРАЦИЮ ПОЛЬЗОВАТЕЛЯ ВЫДАВАЯ ЕМУ СТАТУС ОДОБРЕН, УВЕДОМЛЯЕТ ПОЛЬЗОВАТЕЛЯ, ПОЛЬЗОВАТЕЛЮ ПРИХОДИТ ОДОБРИТЕЛЬНОЕ ПИСЬМО О РЕГИСТРАЦИИ И ИНСТРУКЦИЯ ПО УСТАНОВКЕ ИГРЫ
					│   └── \ОТКЛОНИТЬ\ - УДАЛЯЕТ ЗАЯВКУ И ПРОФИЛЬ ПОЛЬЗОВАТЕЛЯ, УВЕДОМЛЯЕТ ПОЛЬЗОВАТЕЛЯ
					├── ...ЕСЛИ ОДОБРЕН... - ВЫВОДИТ ИНФУ О ПОЛЬЗОВАТЕЛЕ, ЕГО СТАТУС, И КНОПКИ  УПРАВЛЕНИЯ ЗАПИСЬЮ
					│   ├── \УДАЛИТЬ ЗАПИСЬ\ - УДАЛЯЕТ ПРОФИЛЬ ПОЛЬЗОВАТЕЛЯ, УВЕДОМЛЯЕТ ПОЛЬЗОВАТЕЛЯ
					│   ├── \РЕДАКТИРОВАТЬ ЗАПИСЬ\ - ОТКРЫВАЕТ МЕНЮ ИЗМЕНЕНИЯ НИКА И IP ПОЛЬЗОВАТЕЛЯ, УВЕДОМЛЯЕТ ПОЛЬЗОВАТЕЛЯ О ИЗМЕНЕНИЯХ
					│   ├── \ОТПРАВИТЬ СООБЩЕНИЕ ПОЛЬЗОВАТЕЛЮ\ - ОТПРАВЛЯЕТ В ТГ ЧАТ С БОТОМ СООБЩЕНИЕ ПОЛЬЗОВАТЕЛЮ
					│   ├── \ОТПРАВИТЬ СООБЩЕНИЕ ИГРОКУ\ - ОТПРАВЛЯЕТ В ЧАТ ИГРЫ ПРИВАТНОЕ СООБЩЕНИЕ ИГРОКУ
					│   ├── \ДОБАВИТЬ В WHITELIST\ - ДОБАВЛЯЕТ ИГРОКА В WHITELIST И СОЗДАЕТ UFW ПРАВИЛО (whitelist.py)
					│   └── \ИСКЛЮЧИТЬ ИЗ WHITELIST\ - УДАЛЯЕТ ИГРОКА ИЗ WHITELIST И УДАЛЯЕТ UFW ПРАВИЛО (whitelist.py)
					└── ...ЕСЛИ ОДОБРЕН, НО ЕСТЬ ЗАПРОС НА ИЗМЕНЕНИЕ ДАННЫХ ПРОФИЛЯ... - ПРИ ЗАПРОСЕ НА ИЗМЕНЕНИЕ ПОЯВЛЯЕТСЯ НОВАЯ КНОПКА
						└── \ЗАЯВКА НА ИЗМЕНЕНИЕ\ - УДАЛЯЕТ ПРОФИЛЬ ПОЛЬЗОВАТЕЛЯ, УВЕДОМЛЯЕТ ПОЛЬЗОВАТЕЛЯ
							├── \ОДОБРИТЬ\ - МЕНЯЕТ ДАННЫЕ ПОЛЬЗОВАТЕЛЯ, НО ПЕРЕД ЭТИМ УДАЛЯЕТ СТАРЫЕ ДАННЫЕ (whitelist.py)
							└── \ОТКЛОНИТЬ\ - ОТМЕНЯЕТ ИЗМЕНЕНИЯ, ЗАКРЫВАЕТ ДИАЛОГ
```

## Пример .env файла
```shell
# Токен Telegram-бота, полученный у BotFather
BOT_TOKEN=1234567890:QWErTY1u23I4o5p6_as7d8FGhJK9OG1H23j
ADMIN_IDS=123456789,987654321

# Путь к базе данных SQLite
DB_PATH=/tmp/mineservtelebot/users.db

# Дополнительные настройки (INFO \ DEBUG)
LOG_LEVEL=DEBUG
```